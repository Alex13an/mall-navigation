<template>
  <div class="picture" id="mall-svg">
    <svg
      class="map-svg"
      version="1.0"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 1969.000000 1229.000000"
      preserveAspectRatio="xMidYMid meet"
    >
      <defs id="svgEditorDefs">
        <polygon
          id="svgEditorPolygonDefs"
          stroke="black"
          fill="white"
          style="vector-effect: non-scaling-stroke; stroke-width: 1px"
        />
        <line
          id="svgEditorLineDefs"
          stroke="black"
          style="fill: none; vector-effect: non-scaling-stroke; stroke-width: 1px"
        />
        <path
          id="svgEditorClosePathDefs"
          stroke="black"
          fill="khaki"
          style="vector-effect: non-scaling-stroke; stroke-width: 1px"
        />
      </defs>
      <!-- ========================================= -->

      <rect
        id="svgEditorBackground"
        x="0"
        y="0"
        width="1969.000000pt"
        height="1229.000000pt"
        style="fill: none; stroke: none"
      />
      <!-- BEGIN MALL MAP -->
      <g transform="translate(0.000000,1229.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none">
        <!-- purple -->
        <path class="purple" d="M8227 6322 l-137 -137 420 -420 420 -420 137 138 138 137 -420 420 -420 420 -138 -138z" />
        <path
          class="purple"
          d="M8597 6692 l-207 -207 420 -420 420 -420 90 90 90 90 0 235 0 235 -303 303 -302 302 -208 -208z"
        />
        <path class="purple" d="M7897 5992 l-167 -167 420 -420 420 -420 167 168 168 167 -420 420 -420 420 -168 -168z" />
        <path
          class="purple"
          d="M7562 5657 l-142 -142 0 -50 0 -50 395 -395 395 -395 156 155 c85 85 159 162 164 171 7 12 -82 106 -408 432 l-417 417 -143 -143z"
        />
        <path class="purple" d="M3070 5147 l0 -372 168 -168 167 -167 143 0 142 0 0 540 0 540 -310 0 -310 0 0 -373z" />
        <path class="purple" d="M3720 4980 l0 -540 365 0 365 0 0 540 0 540 -365 0 -365 0 0 -540z" />
        <path class="purple" d="M4480 4980 l0 -540 285 0 285 0 0 540 0 540 -285 0 -285 0 0 -540z" />
        <path class="purple" d="M5080 4980 l0 -540 440 0 440 0 0 540 0 540 -440 0 -440 0 0 -540z" />
        <path class="purple" d="M5990 4980 l0 -540 375 0 375 0 0 540 0 540 -375 0 -375 0 0 -540z" />
        <path
          class="purple"
          d="M6770 4980 l0 -540 435 0 435 0 0 353 0 352 -125 125 -125 125 0 62 0 63 -310 0 -310 0 0 -540z"
        />
        <path class="purple" d="M7670 4777 l0 -337 178 0 177 0 80 80 80 80 -258 258 -257 257 0 -338z" />
        <path
          class="purple"
          d="M9570 10035 l-345 -345 295 -295 295 -295 320 320 320 320 203 0 202 0 0 320 0 320 -473 0 -472 0 -345 -345z"
        />
        <path
          class="purple"
          d="M10890 10060 l0 -320 393 0 c369 0 395 1 410 18 15 16 17 54 17 320 l0 302 -410 0 -410 0 0 -320z"
        />
        <path
          class="purple"
          d="M10157 9392 l-317 -317 273 -273 272 -272 123 123 122 122 0 468 0 467 -78 0 -77 0 -318 -318z"
        />
        <path class="purple" d="M10660 9380 l0 -230 250 0 250 0 0 230 0 230 -250 0 -250 0 0 -230z" />
        <path id="store4-7" class="purple" d="M11190 9455 l0 -155 260 0 261 0 -3 153 -3 152 -257 3 -258 2 0 -155z" />
        <path id="store4-6" class="purple" d="M11190 9120 l0 -150 260 0 260 0 0 150 0 150 -260 0 -260 0 0 -150z" />
        <path
          id="store4-1"
          class="purple"
          d="M9760 7865 l-455 -455 310 -310 310 -310 235 0 235 0 340 340 340 340 -425 425 c-234 234 -427 425 -430 425 -3 0 -210 -205 -460 -455z"
        />
        <path
          id="store4-3"
          class="purple"
          d="M10660 8936 l0 -183 -56 -53 -56 -53 426 -426 426 -426 155 155 155 155 0 47 0 48 -275 0 -275 0 0 460 0 460 -250 0 -250 0 0 -184z"
        />
        <path id="store4-5" class="purple" d="M11190 8790 l0 -150 260 0 260 0 0 150 0 150 -260 0 -260 0 0 -150z" />
        <path
          id="store4-2"
          class="purple"
          d="M10380 8485 l-135 -135 428 -428 427 -427 137 138 138 137 -425 425 c-234 234 -427 425 -430 425 -3 0 -66 -61 -140 -135z"
        />
        <path id="store4-4" class="purple" d="M11190 8420 l0 -190 260 0 260 0 0 190 0 190 -260 0 -260 0 0 -190z" />

        <!-- blue -->
        <path id="store2-4" class="blue" d="M12700 8705 l0 -195 215 0 215 0 0 195 0 195 -215 0 -215 0 0 -195z" />
        <path id="store2-3" class="blue" d="M13160 8350 l0 -550 525 0 525 0 0 550 0 550 -525 0 -525 0 0 -550z" />
        <path id="store2-1" class="blue" d="M14240 8350 l0 -550 135 0 135 0 0 550 0 550 -135 0 -135 0 0 -550z" />
        <path id="store2-2" class="blue" d="M14540 8350 l0 -550 155 0 155 0 0 550 0 550 -155 0 -155 0 0 -550z" />
        <path class="blue" d="M14880 8350 l0 -550 300 0 300 0 125 62 125 63 0 487 0 488 -425 0 -425 0 0 -550z" />
        <path
          class="blue"
          d="M15760 8420 l0 -480 33 13 c17 8 116 56 220 108 l187 94 0 372 0 373 -220 0 -220 0 0 -480z"
        />
        <path
          id="store2-5"
          class="blue"
          d="M12700 8302 l0 -177 163 -163 162 -162 53 0 52 0 0 340 0 340 -215 0 -215 0 0 -178z"
        />

        <!-- green -->
        <path class="green" d="M15727 7112 l-157 -157 0 -163 0 -162 315 0 315 0 0 320 0 320 -158 0 -157 0 -158 -158z" />
        <path
          id="store3-5"
          class="green"
          d="M11522 7167 l-92 -92 163 -163 162 -162 48 0 47 0 0 255 0 255 -118 0 -117 0 -93 -93z"
        />
        <path id="store3-4" class="green" d="M11880 6185 l0 -1075 320 0 320 0 0 1075 0 1075 -320 0 -320 0 0 -1075z" />
        <path
          id="store3-3"
          class="green"
          d="M12550 6185 l0 -1075 188 0 187 0 95 -95 94 -95 43 42 43 42 0 1128 0 1128 -325 0 -325 0 0 -1075z"
        />
        <path
          id="store3-2"
          class="green"
          d="M13230 6148 l0 -1113 572 572 573 573 -83 83 -82 82 0 458 0 457 -490 0 -490 0 0 -1112z"
        />
        <path
          id="store3-1"
          class="green"
          d="M14240 6812 l0 -447 88 -88 87 -87 153 0 152 0 0 383 0 384 -159 151 -159 152 -81 0 -81 0 0 -448z"
        />
        <path
          id="store3-6"
          class="green"
          d="M11295 6940 l-110 -110 230 -230 230 -230 102 0 103 0 0 175 0 175 -57 0 -58 0 -165 165 -165 165 -110 -110z"
        />
        <path
          id="store3-7"
          class="green"
          d="M11027 6672 l-127 -127 235 -235 c129 -129 235 -239 235 -245 0 -5 -82 -92 -182 -192 l-183 -183 120 -120 119 -120 31 30 31 30 272 0 272 0 0 415 0 415 -113 0 -112 0 -230 230 c-126 127 -232 230 -235 230 -3 0 -63 -57 -133 -128z"
        />
        <path class="green" d="M15570 6395 l0 -205 315 0 315 0 0 205 0 205 -315 0 -315 0 0 -205z" />
        <path
          class="green"
          d="M10827 6472 l-47 -48 0 -190 0 -189 100 -100 99 -99 3 -63 3 -63 172 172 173 173 -228 228 -227 227 -48 -48z"
        />
        <path
          class="green"
          d="M11297 5453 l-27 -27 85 -87 85 -86 0 -60 c0 -32 5 -64 12 -71 9 -9 68 -12 205 -12 l193 0 0 185 0 185 -263 0 -262 0 -28 -27z"
        />
        <path class="green" d="M11800 2905 l105 -105 147 0 148 0 0 105 0 105 -252 0 -253 0 105 -105z" />
        <path
          class="green"
          d="M11588 4987 l92 -92 0 -113 0 -112 435 0 435 0 77 -81 77 -80 193 193 193 193 -92 92 -93 93 -705 0 -705 0 93 -93z"
        />
        <path class="green" d="M11680 3680 l0 -640 480 0 480 0 0 640 0 640 -480 0 -480 0 0 -640z" />
        <path
          class="green"
          d="M11680 4495 l0 -145 480 0 480 0 0 47 c0 34 6 53 21 69 l22 23 -73 76 -73 75 -429 0 -428 0 0 -145z"
        />

        <!-- orange -->
        <path
          class="orange"
          d="M9690 5325 l-105 -105 205 -205 205 -205 192 192 193 193 -117 117 -118 118 -175 0 -175 0 -105 -105z"
        />
        <path
          class="orange"
          d="M10227 4992 l-207 -207 115 -115 115 -115 0 -95 0 -95 270 270 270 270 -147 147 c-125 125 -152 148 -178 148 -26 0 -59 -29 -238 -208z"
        />
        <path
          class="orange"
          d="M9435 5070 l-120 -120 223 -223 222 -222 0 -68 0 -67 230 0 230 0 0 83 0 82 -328 328 c-180 180 -329 327 -332 327 -3 0 -59 -54 -125 -120z"
        />
        <path
          class="orange"
          d="M9122 4757 l-162 -162 218 -218 217 -217 128 0 127 0 0 68 c0 66 1 69 40 107 37 36 40 43 40 95 l0 55 -218 218 c-119 119 -219 217 -222 217 -3 0 -78 -73 -168 -163z"
        />
        <path class="orange" d="M10760 4825 l-55 -55 53 -52 52 -53 55 55 55 55 -53 53 -53 52 -54 -55z" />
        <path
          class="orange"
          d="M10873 4688 l-63 -63 -58 58 c-32 31 -62 57 -67 57 -6 0 -93 -83 -195 -185 l-185 -185 378 0 377 0 0 90 0 90 85 0 85 0 0 31 c0 25 -14 45 -67 100 l-66 69 -81 0 -81 0 -62 -62z"
        />
        <path
          class="orange"
          d="M8770 4405 l-165 -165 108 -108 107 -107 0 -198 0 -197 -55 0 -55 0 2 -412 3 -413 288 -3 287 -2 0 140 0 140 45 0 45 0 -2 528 -1 527 -221 217 -221 218 -165 -165z"
        />
        <path class="orange" d="M11080 4450 l0 -80 75 0 75 0 0 80 0 80 -75 0 -75 0 0 -80z" />
        <path
          class="orange"
          d="M9707 4312 c-25 -26 -27 -35 -27 -105 l0 -77 -135 0 -135 0 0 -540 0 -540 -45 0 -45 0 0 -125 0 -125 833 0 832 0 123 123 122 122 0 648 0 647 -748 0 -748 0 -27 -28z"
        />
        <path
          class="orange"
          d="M8517 4152 l-57 -58 0 -267 0 -267 110 0 110 0 0 50 0 50 55 0 55 0 0 173 -1 172 -102 103 c-56 56 -104 102 -107 102 -3 0 -31 -26 -63 -58z"
        />
        <path
          class="orange"
          d="M8327 3972 l-67 -68 0 -307 0 -307 210 0 210 0 0 120 0 120 -125 0 -125 0 0 255 c0 300 3 294 -103 187z"
        />
        <path class="orange" d="M3242 3717 l-162 -162 0 -113 0 -112 310 0 310 0 0 275 0 275 -148 0 -147 0 -163 -163z" />
        <path
          class="orange"
          d="M3730 3590 l0 -290 -60 0 -60 0 0 -255 0 -255 345 0 345 0 0 545 0 545 -285 0 -285 0 0 -290z"
        />
        <path class="orange" d="M4330 3335 l0 -545 320 0 320 0 0 545 0 545 -320 0 -320 0 0 -545z" />
        <path class="orange" d="M5000 3335 l0 -545 555 0 555 0 0 545 0 545 -555 0 -555 0 0 -545z" />
        <path
          class="orange"
          d="M6140 3335 l0 -545 305 0 305 0 0 210 0 210 40 0 40 0 0 335 0 335 -345 0 -345 0 0 -545z"
        />
        <path class="orange" d="M6860 3545 l0 -335 260 0 260 0 0 218 0 217 -118 118 -117 117 -143 0 -142 0 0 -335z" />
        <path class="orange" d="M3080 3045 l0 -255 250 0 250 0 0 255 0 255 -250 0 -250 0 0 -255z" />
        <path class="orange" d="M8260 3030 l0 -230 208 2 207 3 3 228 2 227 -210 0 -210 0 0 -230z" />
        <path class="orange" d="M6780 2985 l0 -195 300 0 300 0 0 195 0 195 -300 0 -300 0 0 -195z" />

        <!-- kiosks -->
        <path class="kiosk" d="M4910 4155 l0 -105 160 0 160 0 0 105 0 105 -160 0 -160 0 0 -105z" />
        <path class="kiosk" d="M7020 4155 l0 -105 160 0 160 0 0 105 0 105 -160 0 -160 0 0 -105z" />
        <path class="kiosk" d="M7720 4155 l0 -105 160 0 160 0 0 105 0 105 -160 0 -160 0 0 -105z" />
        <path
          id="store1-1"
          class="kiosk"
          d="M11575 7750 l-110 -110 75 -75 75 -75 110 110 110 110 -75 75 -75 75 -110 -110z"
        />
        <path class="kiosk" d="M9295 5490 l-110 -110 75 -75 75 -75 110 110 110 110 -75 75 -75 75 -110 -110z" />
        <path id="store1-2" class="kiosk" d="M14220 7545 l0 -105 160 0 160 0 0 105 0 105 -160 0 -160 0 0 -105z" />
        <path
          id="store1-3"
          class="kiosk"
          d="M10775 6950 l-110 -110 75 -75 75 -75 110 110 110 110 -75 75 -75 75 -110 -110z"
        />

        <!-- anchors -->
        <path
          tooltip="tooltip inline"
          class="anchor"
          id="jcp"
          d="M3440 2495 l0 -265 355 0 355 0 0 -935 0 -935 2845 0 2845 0 0 1200 0 1200 -3200 0 -3200 0 0 -265z"
        />
        <path
          class="anchor"
          d="M13537 5292 l-867 -867 0 -693 0 -692 62 0 63 0 300 -299 300 -298 2035 561 2035 562 3 414 2 415 -335 335 c-184 184 -335 342 -335 350 0 16 629 650 645 650 5 0 115 -105 242 -232 l233 -233 0 448 0 447 -1758 0 -1757 0 -868 -868z"
        />
        <path
          class="anchor"
          d="M7402 8767 l-1342 -1342 805 -805 805 -805 1345 1345 1345 1345 -802 802 c-442 442 -805 803 -808 803 -3 0 -609 -604 -1348 -1343z"
        />
        <path class="anchor" id="kmart" d="M770 4150 l0 -3040 935 0 935 0 0 3040 0 3040 -935 0 -935 0 0 -3040z" />
        <path class="anchor" id="amc" d="M12700 10025 l0 -1095 1870 0 1870 0 0 1095 0 1095 -1870 0 -1870 0 0 -1095z" />
        <path
          class="anchor"
          id="sears"
          d="M16470 9565 l0 -665 -120 0 -120 0 0 -1355 0 -1355 1380 0 1380 0 0 2020 0 2020 -1260 0 -1260 0 0 -665z"
        />
      </g>
      <circle
        v-for="route in mapRoutes"
        :key="route.id"
        :id="route.id"
        :data-neighbors="route.dateNeighbors"
        :style="vertexStyle"
        :cx="route.cx"
        :cy="route.cy"
        :r="radius"
      />

      <!-- route line -->
      <template v-if="dijkstraPath">
        <path
          v-for="(line, index) in dijkstraPath"
          :key="line.x1 + line.y1"
          class="path-dash"
          :style="{ animation: `draw 2s linear forwards ${0.3 * index}s` }"
          :d="'M' + line.x1 + ',' + line.y1 + 'L' + line.x2 + ',' + line.y2"
          style="stroke: #1e7145; stroke-width: 10px"
        />
      </template>
    </svg>
  </div>
</template>

<script>
import { mapRoutes, radius, vertexStyle } from './MapRoutes';
import { graph } from './MapParser';

export default {
  data() {
    return {
      mapRoutes,
      radius,
      vertexStyle,
      startNode: 'route1-1',
      endNode: 'route1-10',
    };
  },
  computed: {
    dijkstraPath() {
      if (!this.startNode || !this.endNode || this.startNode === this.endNode) {
        return null;
      }
      const routeGraph = graph.Dijkstra(this.startNode, this.endNode);
      return routeGraph.reduce((result, node, index, gr) => {
        if (!gr[index + 1]) return result;

        const currentRoute = mapRoutes.find((r) => r.id === node);
        const nextRoute = mapRoutes.find((r) => r.id === gr[index + 1]);
        result.push({
          x1: currentRoute.cx,
          y1: currentRoute.cy,
          x2: nextRoute.cx,
          y2: nextRoute.cy,
        });
        return result;
      }, []);
    },
  },
};
</script>

<style lang="scss" scoped>
.picture {
  max-width: 100%;
  max-height: 100%;
  background: #eef;
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  right: 0;
  svg {
    width: 100%;
    height: 100%;
  }
}

.blue {
  fill: #2d89ef;
}

.blue:hover {
  fill: rgba($color: #2d89ef, $alpha: 0.8);
}

.green {
  fill: #00a300;
}

.green:hover {
  fill: rgba($color: #00a300, $alpha: 0.8);
}

.purple {
  fill: #7e3878;
}

.purple:hover {
  fill: rgba($color: #7e3878, $alpha: 0.8);
}

.orange {
  fill: #e3a21a;
}

.orange:hover {
  fill: rgba($color: #e3a21a, $alpha: 0.8);
}

.anchor {
  fill: #00aba9;
}

.anchor:hover {
  fill: rgba($color: #00aba9, $alpha: 0.8);
}

.kiosk {
  fill: #b91d47;
}

.kiosk:hover {
  fill: rgba($color: #b91d47, $alpha: 0.8);
}

.path-dash {
  stroke-dasharray: 450;
  stroke-dashoffset: 450;
}
</style>

<style lang="scss">
@keyframes draw {
  to {
    stroke-dashoffset: 0;
  }
}
</style>
